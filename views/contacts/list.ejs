<%- include('../layout-header', { title: 'Contacts' }) %>

<div class="page-header">
  <h1>Contacts <span class="count-badge"><%= totalCount %></span></h1>
  <div class="page-actions">
    <a href="/contacts/import" class="btn btn-secondary">Import CSV</a>
  </div>
</div>

<form class="filter-bar" method="GET" action="/contacts">
  <input type="text" name="search" value="<%= search %>" placeholder="Search contacts..." class="filter-input">
  <select name="filter" class="filter-select">
    <option value="all" <%= filter === 'all' ? 'selected' : '' %>>All Contacts</option>
    <option value="missing-email" <%= filter === 'missing-email' ? 'selected' : '' %>>Missing Email</option>
    <option value="missing-phone" <%= filter === 'missing-phone' ? 'selected' : '' %>>Missing Phone</option>
  </select>
  <button type="submit" class="btn btn-primary btn-sm">Filter</button>
</form>

<% if (contacts.length === 0) { %>
  <div class="empty-state">
    <p>No contacts found. <a href="/contacts/import">Import a CSV</a> to get started.</p>
  </div>
<% } else { %>
<div class="table-responsive">
  <table class="data-table" id="contacts-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Organization</th>
        <th>City</th>
        <th>State</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% contacts.forEach(function(c) { %>
      <tr data-contact-id="<%= c.id %>">
        <td>
          <span class="editable" data-field="first_name" data-id="<%= c.id %>"><%= c.first_name || '' %></span>
          <span class="editable" data-field="last_name" data-id="<%= c.id %>"><%= c.last_name || '' %></span>
        </td>
        <td><span class="editable" data-field="email" data-id="<%= c.id %>"><%= c.email || '' %></span></td>
        <td><span class="editable" data-field="phone" data-id="<%= c.id %>"><%= c.phone || '' %></span></td>
        <td><span class="editable" data-field="organization" data-id="<%= c.id %>"><%= c.organization || '' %></span></td>
        <td><span class="editable" data-field="city" data-id="<%= c.id %>"><%= c.city || '' %></span></td>
        <td><span class="editable" data-field="state" data-id="<%= c.id %>"><%= c.state || '' %></span></td>
        <td>
          <button class="btn btn-sm btn-danger delete-contact" data-id="<%= c.id %>">Delete</button>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<%- include('../partials/pagination', { currentPage, totalPages, baseUrl, search, filter }) %>
<% } %>

<%- include('../layout-footer', { scripts: ['/js/contacts.js'] }) %>
