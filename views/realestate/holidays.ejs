<%- include('../layout-header', { title: 'Holidays' }) %>

<div class="page-header">
  <h1>Holidays</h1>
  <div class="page-actions">
    <form method="POST" action="/realestate/holidays/seed" style="display:inline;">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <button type="submit" class="btn btn-secondary btn-sm">Seed US Holidays</button>
    </form>
  </div>
</div>

<!-- Add Custom Holiday -->
<div class="form-card">
  <h3>Add Custom Holiday</h3>
  <form method="POST" action="/realestate/holidays">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <div class="form-row">
      <div class="form-group">
        <label for="name">Holiday Name</label>
        <input type="text" id="name" name="name" placeholder="e.g. Company Anniversary" required>
      </div>
      <div class="form-group">
        <label for="date">Date</label>
        <input type="date" id="date" name="date" required>
      </div>
    </div>
    <button type="submit" class="btn btn-primary btn-sm">Add Holiday</button>
  </form>
</div>

<!-- Holiday List -->
<% if (holidays.length === 0) { %>
  <div class="empty-state">
    <p>No holidays found. Click "Seed US Holidays" to add preset holidays, or add custom ones above.</p>
  </div>
<% } else { %>
<input type="hidden" name="_csrf" value="<%= csrfToken %>">
<div class="table-responsive">
  <table class="data-table" id="holidays-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Date</th>
        <th>Type</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% holidays.forEach(function(h) { %>
      <tr data-holiday-id="<%= h.id %>">
        <td><strong><%= h.name %></strong></td>
        <td><%= h.date %></td>
        <td>
          <% if (h.is_preset) { %>
            <span class="badge badge-status-sent">Preset</span>
          <% } else { %>
            <span class="badge badge-status-draft">Custom</span>
          <% } %>
        </td>
        <td>
          <% if (!h.is_preset) { %>
            <button class="btn btn-sm btn-danger delete-holiday-btn" data-id="<%= h.id %>">Delete</button>
          <% } %>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>
<% } %>

<a href="/realestate" class="btn btn-link" style="margin-top: 1rem; display: inline-block;">Back to Real Estate</a>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var table = document.getElementById('holidays-table');
  if (!table) return;

  function getCsrf() {
    var el = document.querySelector('input[name="_csrf"]');
    return el ? el.value : '';
  }

  table.addEventListener('click', function(e) {
    var btn = e.target.closest('.delete-holiday-btn');
    if (!btn) return;
    if (!confirm('Delete this holiday?')) return;

    var id = btn.dataset.id;
    var row = btn.closest('tr');

    fetch('/api/holidays/' + id, {
      method: 'DELETE',
      headers: { 'X-CSRF-Token': getCsrf() },
    })
    .then(function(r) { return r.json(); })
    .then(function(data) {
      if (data.success) row.remove();
    });
  });
});
</script>

<%- include('../layout-footer', { scripts: [] }) %>
